<div class="flex flex-col items-center pb-8 justify-center min-h-screen px-4 bg-background text-text">
    <h1 class="text-2xl md:text-3xl font-bold mb-6 text-center">
        Craft your unique quotation
    </h1>

    <form [formGroup]="quotationForm" (ngSubmit)="onSubmit()" class="relative w-full max-w-4xl">
        <div class="p-6 rounded-lg shadow-lg glass">
            <div class="absolute inset-0 w-full h-full rounded-lg opacity-20 z-0 bg-image"></div>

            <div class="relative z-10">
                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">
                        Title
                    </label>
                    <input formControlName="title"
                        class="w-full p-2 border rounded input-field focus:outline-none focus:ring-2 focus:ring-primary transition duration-300"
                        placeholder="Title" type="text" />
                </div>

                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">
                        Description
                    </label>
                    <textarea formControlName="description"
                        class="w-full p-2 border rounded input-field focus:outline-none focus:ring-2 focus:ring-primary transition duration-300"
                        placeholder="Description" rows="4"></textarea>
                </div>

                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">
                        Theme
                    </label>
                    <input formControlName="theme"
                        class="w-full p-2 border rounded input-field focus:outline-none focus:ring-2 focus:ring-primary transition duration-300"
                        placeholder="Theme" type="text" />
                </div>

                <div class="mb-4 flex flex-col md:flex-row md:space-x-4">
                    <div class="flex-1 mb-4 md:mb-0">
                        <label class="block text-lg font-bold mb-2">
                            Due Date
                        </label>
                        <div class="flex items-center">
                            <span class="mr-2 font-bold">Before</span>
                            <input formControlName="dueDate"
                                class="w-full p-2 border rounded input-field focus:outline-none focus:ring-2 focus:ring-primary transition duration-300"
                                type="datetime-local" />
                        </div>
                        <!-- <div class="flex items-center">
                            <span class="mr-2 font-bold">Before</span>
                            <div class="relative w-full">
                                <label class="w-full cursor-pointer" for="dueDateInput">
                                    <div
                                        class="p-2 border rounded input-field focus:outline-none transition duration-300 flex justify-between items-center">
                                        <span *ngIf="quotationForm.get('dueDate')?.value">{{
                                            quotationForm.get('dueDate')?.value | localDate:'medium' }}</span>
                                        <span *ngIf="!quotationForm.get('dueDate')?.value" class="text-gray-400">Select
                                            a date and time</span>
                                        <mat-icon class="text-primary">calendar_today</mat-icon>
                                    </div>
                                    <input id="dueDateInput" formControlName="dueDate" class="hidden"
                                        type="datetime-local" />
                                </label>
                            </div>
                        </div> -->
                    </div>

                    <div class="flex-1">
                        <label class="block text-lg font-bold mb-2">
                            Estimated Budget
                        </label>
                        <div class="flex items-center">
                            <span class="text-success font-bold mr-2">â‚¹</span>
                            <input formControlName="estimatedBudget"
                                class="w-full p-2 border rounded input-field focus:outline-none focus:ring-2 focus:ring-primary transition duration-300"
                                placeholder="Price" type="text" />
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">
                        Preferred Output Type
                    </label>
                    <select formControlName="outputType"
                        class="w-full p-2 border rounded input-field focus:outline-none focus:ring-2 focus:ring-primary transition duration-300">
                        <option value="" disabled>Select the type of output you want</option>
                        <option *ngFor="let type of outputTypes" [value]="type">{{ type }}</option>
                    </select>
                    <p class="text-xs mt-1 text-gray-500">Select the type of output you expect from the editor</p>
                </div>

                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">
                        Add Files
                    </label>
                    <div class="flex items-center justify-center w-full">
                        <label
                            class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer file-upload-area"
                            [class.opacity-50]="selectedFiles.length >= maxFiles || isUploading"
                            [class.cursor-not-allowed]="selectedFiles.length >= maxFiles || isUploading">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <svg class="w-8 h-8 mb-2 file-icon" xmlns="http://www.w3.org/2000/svg" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                <p class="text-sm"><span class="font-semibold">Click to upload</span> or drag and drop
                                </p>
                                <p class="text-xs">Image, Audio, or Video files</p>
                            </div>
                            <input type="file" class="hidden" (change)="onFileSelected($event)"
                                accept="image/*, audio/*, video/*" multiple
                                [disabled]="selectedFiles.length >= maxFiles || isUploading" />
                        </label>
                    </div>

                    <!-- Selected files list -->
                    <div *ngIf="selectedFiles.length > 0" class="mt-4">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-text">Selected Files ({{ selectedFiles.length }}/{{ maxFiles }})</h4>
                            <button type="button" class="create-button text-white px-4 py-2 rounded"
                                (click)="uploadFiles()" [disabled]="isUploading">
                                <span *ngIf="!isUploading">Upload Files</span>
                                <span *ngIf="isUploading">Uploading...</span>
                            </button>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <div *ngFor="let file of selectedFiles; let i = index"
                                class="file-item-pending rounded p-2 flex items-center">
                                <span class="truncate max-w-xs text-text">{{ file.name }}</span>
                                <button type="button" class="ml-2 text-red-500" (click)="removeFile(i)">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
                    <div *ngIf="uploadProgress === 100">Upload Complete!</div> -->

                    <!-- Upload progress -->
                    <!-- <div *ngIf="isUploading" class="mt-4">
                        <h4 class="font-semibold mb-2">Upload Progress</h4>
                        <div *ngFor="let progress of cloudinaryService.uploadProgress$ | async" class="mb-2">
                            <div class="flex justify-between mb-1">
                                <span>{{ progress.file.name }}</span>
                                <span>{{ progress.progress }}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-primary h-2.5 rounded-full" [style.width.%]="progress.progress"></div>
                            </div>
                        </div>
                    </div> -->

                    <!-- Uploaded files -->
                    <div *ngIf="uploadedFiles.length > 0" class="mt-4">
                        <h4 class="font-semibold mb-2 text-text">Uploaded Files ({{ uploadedFiles.length }})</h4>
                        <div class="flex flex-wrap gap-2">
                            <div *ngFor="let file of uploadedFiles" 
                                class="file-item-uploaded rounded p-2 flex items-center">
                                <span class="truncate max-w-xs text-text">{{ file.fileName }}</span>
                                <a [href]="file.url" target="_blank" class="ml-2 file-link">
                                    <mat-icon>open_in_new</mat-icon>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end mt-6">
                    <button type="submit"
                        class="create-button w-full sm:w-auto font-bold py-3 px-6 rounded-lg text-white transition duration-300"
                        [disabled]="!quotationForm.valid || isUploading || selectedFiles.length > 0">
                        {{ isUploading ? 'Please wait...' : 'Publish Quotation' }}
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>